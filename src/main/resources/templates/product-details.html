<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title th:text="${product.name}">Product Details</title>
    <style th:href="@{/navbar.css}"></style>
    <style>
        :root{--gap:18px;--accent:#0a74da;--muted:#666}
        body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:20px;color:#111}
        .top{margin-bottom:18px}
        .btn{display:inline-block;padding:8px 12px;border-radius:6px;text-decoration:none;color:white;background:#444}
        .btn.secondary{background:#eee;color:#111;border:1px solid #ddd}
        .layout{display:flex;gap:var(--gap);align-items:flex-start}
        .media{flex:1 1 48%;max-width:48%}
        .media img{width:100%;height:auto;border-radius:8px;object-fit:cover}
        .details{flex:1 1 48%;max-width:48%;display:flex;flex-direction:column;gap:12px}
        .title{font-size:1.6rem;margin:0}
        .desc{color:var(--muted);line-height:1.5}
        .actions{margin-top:auto;display:flex;gap:10px;align-items:center}
        .like-btn{background:transparent;border:1px solid #eee;padding:8px 10px;border-radius:8px;cursor:pointer;display:inline-flex;align-items:center;gap:8px}
        .buy-btn{background:var(--accent);color:#fff;border:none;padding:10px 16px;border-radius:8px;cursor:pointer}
        @media (max-width:800px){.layout{flex-direction:column}.media,.details{max-width:100%}}
    </style>
</head>
<body>
    <div th:replace="fragments/navbar :: navbar"></div>
    <br/><br/><br/>
    <div class="top">
        <a class="btn secondary" th:href="@{/products}">← Back to products</a>
    </div>

    <p id="productId" th:text="${productId}" hidden></p>
    

    <div class="layout">
        <div class="media">
            <img th:src="@${product.image}" th:alt="${product.name}" alt="Product image"/>
        </div>

        <div class="details">
            <h1 class="title" th:text="${product.name}">Product name</h1>
            <p class="desc" th:text="${product.description}">Product description goes here.</p>

            <div class="actions">
                <button class="like-btn" id="likeBtn" th:data-product-id="${product.id}" aria-pressed="false">
                    <span id="likeIcon">♡</span>
                    <span id="likeCount" th:text="${product.likes}">0</span>
                </button>

                <form th:action="@{/cart/add/{id}(id=${product.id})}" method="post" style="display:inline">
                    <button type="submit" class="buy-btn">Buy</button>
                </form>
            </div>
        </div>
    </div>
    <script th:inline="javascript">

        // Thymeleaf injects productId into JS
        //const productId = document.getElementById("productId").textContent;

        /*<![CDATA[*/
        let productId = '[[${productId}]]';
        console.log("Product ID:", productId);
        /*]]>*/
        let products = [];  

        fetch(`/api/products/${productId}`)
        .then(response => response.json())
        .then(foundproduct => {
            product = foundproduct;
        });
        

        // Simple optimistic UI for the like button (replace with real AJAX in production)
        (function(){
            const likeBtn = document.getElementById('likeBtn');
            if(!likeBtn) return;
            const likeCountEl = document.getElementById('likeCount');
            const likeIcon = document.getElementById('likeIcon');
            let liked = false;
            likeBtn.addEventListener('click', function(){
                liked = !liked;
                likeBtn.setAttribute('aria-pressed', liked ? 'true' : 'false');
                likeIcon.textContent = liked ? '♥' : '♡';
                likeCountEl.textContent = String(Number(likeCountEl.textContent || 0) + (liked ? 1 : -1));
                // Example: send fetch to backend
                /*
                fetch('/api/products/' + likeBtn.dataset.productId + '/like', {method: 'POST'})
                    .catch(()=>{ // revert on error
                        liked = !liked;
                        likeBtn.setAttribute('aria-pressed', liked ? 'true' : 'false');
                        likeIcon.textContent = liked ? '♥' : '♡';
                        likeCountEl.textContent = String(Number(likeCountEl.textContent || 0) + (liked ? 1 : -1));
                    });*/
                
            });
        })();
    </script>

</body>
</html>