<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Wishlist</title>
  <link rel="stylesheet" th:href="@{/navbar.css}">
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f7f7f9; }
    h1 { margin-bottom: 20px; }
    .wishlist { display: grid; gap: 16px; }
    .item { display: flex; align-items: center; background: #fff; border: 1px solid #ddd; border-radius: 8px; padding: 12px; }
    .item img { width: 80px; height: 80px; object-fit: cover; border-radius: 6px; margin-right: 16px; }
    .info { flex: 1; }
    .name { font-weight: bold; margin-bottom: 4px; }
    .price { color: green; margin-bottom: 8px; }
    .btn { padding: 6px 12px; border-radius: 6px; cursor: pointer; margin-left: 8px; }
    .remove-btn { background: #c62828; color: #fff; border: none; }
    .remove-btn:hover { background: #a61c1c; }
    .cart-btn { background: #0b6efd; color: #fff; border: none; }
    .cart-btn:hover { background: #0846a3; }
    .empty { color: #666; font-style: italic; }
  </style>
</head>
<body>
    <div th:replace="fragments/navbar :: navbar"></div>
    <br><br><br>
  <h1>Your Wishlist</h1>
  
  <div id="wishlist" class="wishlist"></div>

  <script>
    const likesKey = 'product_likes_v1';
    const productsKey = 'products_cache_v1';
    const cartKey = 'shopping_cart_v1';

    let likes = JSON.parse(localStorage.getItem(likesKey) || '{}');
    let products = JSON.parse(localStorage.getItem(productsKey) || '[]');
    let cart = JSON.parse(localStorage.getItem(cartKey) || '[]');

    function saveCart() {
      localStorage.setItem(cartKey, JSON.stringify(cart));
    }

    function renderWishlist() {
      const wishlistEl = document.getElementById('wishlist');
      wishlistEl.innerHTML = '';

      const likedProducts = products.filter(p => likes[p.id]);
      if (likedProducts.length === 0) {
        wishlistEl.innerHTML = '<div class="empty">No items in your wishlist.</div>';
        return;
      }

      likedProducts.forEach(p => {
        const div = document.createElement('div');
        div.className = 'item';
        div.innerHTML = `
          <img src="${p.image}" alt="${p.name}">
          <div class="info">
            <div class="name">${p.name}</div>
            <div class="price">$${p.price.toFixed(2)}</div>
          </div>
          <button class="btn cart-btn">Move to Cart</button>
          <button class="btn remove-btn">Remove</button>
        `;

        // Remove from wishlist
        div.querySelector('.remove-btn').addEventListener('click', () => {
          delete likes[p.id];
          localStorage.setItem(likesKey, JSON.stringify(likes));
          renderWishlist();
        });

        // Move to cart
        div.querySelector('.cart-btn').addEventListener('click', () => {
          const existing = cart.find(item => item.id === p.id);
          if (existing) {
            existing.quantity = (existing.quantity || 1) + 1;
          } else {
            cart.push({ id: p.id, name: p.name, price: p.price, image: p.image, quantity: 1 });
          }
          saveCart();
          alert(`Moved "${p.name}" to cart.`);
        });

        wishlistEl.appendChild(div);
      });
    }

    renderWishlist();
  </script>
</body>
</html>

